import{Y as le,r as N,S as re,a0 as de,al as ce,a1 as fe,Z as te,E as B,$ as ve,am as pe,H as q,j as A,w as L,g as $,I as oe,N as g,a3 as W,an as M,P as ue,ao as he,ap as me,aq as ge,ar as G,as as ye,M as be,at as ae,D as xe,z as ke,au as Ce,ak as Te,ad as Ie,e as P,h as O,n as _,af as Ee,F as ne,G as se,K as Se,f as ie,Q as Ke,t as we}from"./BjYB2R9l.js";import _e from"./DiN07nLw.js";import{_ as Ae}from"./pnyobPYE.js";function j(d,i,l){const v=d.findIndex(h=>le(h,i)),S=d.findIndex(h=>le(h,l));if(v===-1||S===-1)return[];const[a,p]=[v,S].sort((h,o)=>h-o);return d.slice(a,p+1)}function U(d){return d.reduce((i,l)=>(i.push(l),l.children&&i.push(...U(l.children)),i),[])}function Be(d,i){const l=N(),v=(a,p)=>{if(i.multiple&&Array.isArray(d.value))if(i.selectionBehavior==="replace")d.value=[a],l.value=a;else{const h=d.value.findIndex(o=>p(o));h!==-1?d.value.splice(h,1):d.value.push(a)}else i.selectionBehavior==="replace"?d.value={...a}:!Array.isArray(d.value)&&p(d.value)?d.value=void 0:d.value={...a};return d.value};function S(a,p,h,o){var K;if(!(l!=null&&l.value)||!i.multiple||!Array.isArray(d.value))return;const E=(K=h().filter(w=>w.ref.dataset.disabled!=="").find(w=>w.ref===p))==null?void 0:K.value;if(!E)return;let C=null;switch(a){case"prev":case"next":{C=j(o,l.value,E);break}case"first":{C=j(o,l.value,o==null?void 0:o[0]);break}case"last":{C=j(o,l.value,o==null?void 0:o[o.length-1]);break}}d.value=C}return{firstValue:l,onSelectItem:v,handleMultipleReplace:S}}const[$e,Re]=ve("TreeRoot"),Le=re({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:d=>d.children},selectionBehavior:{default:"toggle"},multiple:{type:Boolean},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(d,{emit:i}){const l=d,v=i,{items:S,multiple:a,disabled:p,propagateSelect:h,dir:o}=de(l),{handleTypeaheadSearch:T}=ce(),E=fe(o),C=N(),K=N(!1),w=pe(),y=te(l,"modelValue",v,{defaultValue:l.defaultValue??(a.value?[]:void 0),passive:l.modelValue===void 0,deep:!0}),n=te(l,"expanded",v,{defaultValue:l.defaultExpanded??[],passive:l.expanded===void 0,deep:!0}),{onSelectItem:u,handleMultipleReplace:e}=Be(y,l),s=B(()=>a.value&&Array.isArray(y.value)?y.value.map(t=>l.getKey(t)):[l.getKey(y.value??{})]);function r(t,f=1,x){return t.reduce((k,I,R)=>{const V=l.getKey(I),D=l.getChildren(I),z=n.value.includes(V),F={_id:V,value:I,index:R,level:f,parentItem:x,hasChildren:!!D,bind:{value:I,level:f,"aria-setsize":t.length,"aria-posinset":R+1}};return k.push(F),D&&z&&k.push(...r(D,f+1,I)),k},[])}const c=B(()=>{const t=l.items;return n.value.map(f=>f),r(t??[])});function m(t){var f;if(K.value)w.trigger(t);else{const x=((f=C.value)==null?void 0:f.getItems())??[];T(t.key,x)}}function b(t){if(K.value)return;const f=me[t.key];ge(()=>{var x;e(f,G(),(x=C.value)==null?void 0:x.getItems,c.value.map(k=>k.value))})}return Re({modelValue:y,selectedKeys:s,onSelect:t=>{var k;const f=I=>l.getKey(I??{})===l.getKey(t),x=l.multiple&&Array.isArray(y.value)?((k=y.value)==null?void 0:k.findIndex(f))!==-1:void 0;if(u(t,f),l.propagateSelect&&l.multiple&&Array.isArray(y.value)){const I=U(l.getChildren(t)??[]);x?y.value=[...y.value].filter(R=>!I.some(V=>l.getKey(R??{})===l.getKey(V))):y.value=[...y.value,...I]}},expanded:n,onToggle(t){if(!(t?l.getChildren(t):void 0))return;const x=l.getKey(t)??t;n.value.includes(x)?n.value=n.value.filter(k=>k!==x):n.value.push(x)},getKey:l.getKey,getChildren:l.getChildren,items:S,expandedItems:c,disabled:p,multiple:a,dir:E,propagateSelect:h,isVirtual:K,virtualKeydownHook:w,handleMultipleReplace:e}),(t,f)=>(A(),q(g(he),{ref_key:"rovingFocusGroupRef",ref:C,"as-child":"",orientation:"vertical",dir:g(E)},{default:L(()=>[$(g(ue),{role:"tree",as:t.as,"as-child":t.asChild,"aria-multiselectable":g(a)?!0:void 0,onKeydown:[m,W(M(b,["shift"]),["up","down"])]},{default:L(()=>[oe(t.$slots,"default",{flattenItems:c.value,modelValue:g(y),expanded:g(n)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),Ve="tree.select",De="tree.toggle",Ne=re({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(d,{expose:i,emit:l}){const v=d,S=l,a=$e(),{getItems:p}=ye(),h=B(()=>!!a.getChildren(v.value)),o=B(()=>{const e=a.getKey(v.value);return a.expanded.value.includes(e)}),T=B(()=>{const e=a.getKey(v.value);return a.selectedKeys.value.includes(e)}),E=B(()=>{if(a.propagateSelect.value&&T.value&&h.value&&Array.isArray(a.modelValue.value))return!U(a.getChildren(v.value)||[]).every(s=>a.modelValue.value.find(r=>a.getKey(r)===a.getKey(s)))});function C(e){if(h.value)if(o.value){const s=p().map(t=>t.ref),r=G(),c=s.indexOf(r),b=[...s].slice(c).find(t=>Number(t.getAttribute("data-indent"))===v.level+1);b&&b.focus()}else u(e)}function K(e){if(o.value)u(e);else{const s=p().map(t=>t.ref),r=G(),c=s.indexOf(r),b=[...s].slice(0,c).reverse().find(t=>Number(t.getAttribute("data-indent"))===v.level-1);b&&b.focus()}}async function w(e){S("select",e),!(e!=null&&e.defaultPrevented)&&a.onSelect(v.value)}async function y(e){S("toggle",e),!(e!=null&&e.defaultPrevented)&&a.onToggle(v.value)}async function n(e){if(!e)return;const s={originalEvent:e,value:v.value,isExpanded:o.value,isSelected:T.value};ae(Ve,w,s)}async function u(e){if(!e)return;const s={originalEvent:e,value:v.value,isExpanded:o.value,isSelected:T.value};ae(De,y,s)}return i({isExpanded:o,isSelected:T,isIndeterminate:E,handleToggle:()=>a.onToggle(v.value),handleSelect:()=>a.onSelect(v.value)}),(e,s)=>(A(),q(g(Ae),{"as-child":"",value:e.value,"allow-shift-key":""},{default:L(()=>[$(g(ue),be(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":T.value,"aria-expanded":h.value?o.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":T.value?"":void 0,"data-expanded":o.value?"":void 0,onKeydown:[W(M(n,["self","prevent"]),["enter","space"]),s[0]||(s[0]=W(M(r=>g(a).dir.value==="ltr"?C(r):K(r),["prevent"]),["right"])),s[1]||(s[1]=W(M(r=>g(a).dir.value==="ltr"?K(r):C(r),["prevent"]),["left"]))],onClick:s[2]||(s[2]=M(r=>{n(r),u(r)},["stop"]))}),{default:L(()=>[oe(e.$slots,"default",{isExpanded:o.value,isSelected:T.value,isIndeterminate:E.value,handleSelect:()=>g(a).onSelect(e.value),handleToggle:()=>g(a).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Pe={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},Fe={__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(d){const i=d,l=xe(),v=ke(),[S,a]=Ce(),p=B(()=>{var n,u;return se({extend:se(Pe),...((u=(n=v.uiPro)==null?void 0:n.prose)==null?void 0:u.codeTree)||{}})()}),h=N(i.defaultValue?{path:i.defaultValue}:void 0),o=N(),T=N(1),E=B(()=>{var n,u;return T.value,((u=(n=l.default)==null?void 0:n.call(l))==null?void 0:u.flatMap(w).filter(Boolean))||[]}),C=B(()=>K(E.value));function K(n){const u=new Map,e=[];n.forEach(r=>{const c=r.label.split("/");let m="";c.forEach((b,t)=>{var f,x;if(m=m?`${m}/${b}`:b,!u.has(m)){const k={label:b,path:m,...t<c.length-1&&{children:[]}};u.set(m,k),t===0?e.push(k):(x=(f=u.get(c.slice(0,t).join("/")))==null?void 0:f.children)==null||x.push(k)}})});const s=r=>r.sort((c,m)=>!!c.children==!!m.children?c.label.localeCompare(m.label):m.children?1:-1).map(c=>({...c,children:c.children&&s(c.children)}));return s(e)}function w(n,u){var e,s,r,c;return typeof n.type=="symbol"?(e=n.children)==null?void 0:e.map(w):{label:((s=n.props)==null?void 0:s.filename)||((r=n.props)==null?void 0:r.label)||`${u}`,icon:(c=n.props)==null?void 0:c.icon,component:n}}const y=B(()=>{var e;if(i.expandAll){const s=new Set;return E.value.forEach(r=>{const c=r.label.split("/");for(let m=1;m<c.length;m++)s.add(c.slice(0,m).join("/"))}),Array.from(s)}const n=(e=h.value)==null?void 0:e.path;if(!n)return[];const u=n.split("/");return u.map((s,r)=>u.slice(0,r+1).join("/"))});return Te(h,n=>{const u=E.value.find(e=>(n==null?void 0:n.path)===e.label);u!=null&&u.component&&(o.value=u)},{immediate:!0}),Ie(()=>T.value++),(n,u)=>{var s,r,c,m;const e=Ke;return A(),P(ne,null,[$(g(S),null,{default:L(({items:b,level:t})=>[(A(!0),P(ne,null,Se(b,(f,x)=>{var k,I;return A(),P("li",{key:`${t}-${x}`,class:_(t>0?p.value.itemWithChildren({class:(k=i.ui)==null?void 0:k.itemWithChildren}):p.value.item({class:(I=i.ui)==null?void 0:I.item}))},[$(g(Ne),{"as-child":"",level:t,value:f},{default:L(({isExpanded:R,isSelected:V})=>{var D,z,F,H,Y,Q,Z,J,X,ee;return[O("button",{class:_(p.value.link({class:(D=i.ui)==null?void 0:D.link,active:V}))},[(z=f.children)!=null&&z.length?(A(),q(e,{key:0,name:R?g(v).ui.icons.folderOpen:g(v).ui.icons.folder,class:_(p.value.linkLeadingIcon({class:(F=i.ui)==null?void 0:F.linkLeadingIcon}))},null,8,["name","class"])):(A(),q(_e,{key:1,filename:f.label,class:_(p.value.linkLeadingIcon({class:(H=i.ui)==null?void 0:H.linkLeadingIcon}))},null,8,["filename","class"])),O("span",{class:_(p.value.linkLabel({class:(Y=i.ui)==null?void 0:Y.linkLabel}))},we(f.label),3),(Q=f.children)!=null&&Q.length?(A(),P("span",{key:2,class:_(p.value.linkTrailing({class:(Z=i.ui)==null?void 0:Z.linkTrailing}))},[$(e,{name:g(v).ui.icons.chevronDown,class:_(p.value.linkTrailingIcon({class:(J=i.ui)==null?void 0:J.linkTrailingIcon}))},null,8,["name","class"])],2)):ie("",!0)],2),(X=f.children)!=null&&X.length&&R?(A(),P("ul",{key:0,class:_(p.value.listWithChildren({class:(ee=i.ui)==null?void 0:ee.listWithChildren}))},[$(g(a),{items:f.children,level:t+1},null,8,["items","level"])],2)):ie("",!0)]}),_:2},1032,["level","value"])],2)}),128))]),_:1}),O("div",{class:_(p.value.root({class:[i.class,(s=i.ui)==null?void 0:s.root]}))},[$(g(Le),{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=b=>h.value=b),class:_(p.value.list({class:(r=i.ui)==null?void 0:r.list})),items:C.value,"get-key":b=>b.path,"default-expanded":y.value},{default:L(()=>[$(g(a),{items:C.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),O("div",{class:_(p.value.content({class:(c=i.ui)==null?void 0:c.content}))},[(A(),q(Ee((m=o.value)==null?void 0:m.component)))],2)],2)],64)}}};export{Fe as default};
